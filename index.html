<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noite dos Mistérios - IA Avançada</title>
    <style>
        :root { --dark: #05070a; --gold: #c5a021; --red: #ff4d4d; --gray: #2a2a2a; }
        body { background: var(--dark); color: white; font-family: sans-serif; display: flex; justify-content: center; margin: 0; }
        #game-container { width: 100%; max-width: 600px; height: 100vh; display: flex; flex-direction: column; border: 1px solid var(--gold); }
        
        /* Cabeçalho */
        .header { padding: 15px; border-bottom: 1px solid var(--gold); background: #000; text-align: center; }
        
        /* Chat */
        #chat-window { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; }
        .msg { padding: 8px 12px; border-radius: 8px; max-width: 85%; font-size: 14px; line-height: 1.4; }
        .bot { background: var(--gray); align-self: flex-start; border-left: 3px solid var(--gold); }
        .player { background: #1a3a5a; align-self: flex-end; border-right: 3px solid #3498db; }
        .system { background: rgba(255,0,0,0.1); align-self: center; color: var(--red); font-weight: bold; width: 90%; text-align: center; }

        /* Controles */
        .controls { padding: 15px; background: #111; display: flex; gap: 5px; }
        input { flex-grow: 1; padding: 10px; border-radius: 4px; border: none; }
        button { padding: 10px; background: var(--gold); border: none; cursor: pointer; font-weight: bold; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="header">
        <h2 id="fase-txt">Noite dos Mistérios</h2>
        <small id="status-txt">Iniciando...</small>
    </div>

    <div id="chat-window">
        </div>

    <div class="controls">
        <input type="text" id="input-msg" placeholder="Pergunte algo (ex: Quem é você? ou Onde estava?)">
        <button onclick="processarTurnoJogador()">Perguntar</button>
    </div>
</div>

<script>
    // Configurações Iniciais
    const nomes = ["Arthur", "Beatriz", "Caio", "Diana", "Erik", "Flora", "Gustavo", "Helena", "Igor", "Julia", "Kevin", "Lara", "Murilo", "Nina", "Otto", "Paula", "Raul"];
    let jogadores = [];
    let logsDoJogo = []; 
    let rodada = 1;

    // Inicialização do Jogo
    function init() {
        // Criar Bots com IA básica
        nomes.forEach(n => {
            jogadores.push({
                nome: n,
                papel: "Cidadão", // Será distribuído
                vivo: true,
                suspeitos: [],
                memoriaLocal: "Estava em casa dormindo."
            });
        });

        // Adicionar Jogador Real (Você)
        jogadores.push({ nome: "Você", papel: "Xerife", vivo: true, suspeitos: [], memoriaLocal: "" });

        distribuirPapeis();
        adicionarMsg("Sistema", "A noite caiu. 18 jogadores estão na vila. Quem é o assassino?");
        simularNoite();
    }

    function distribuirPapeis() {
        const papeisEspeciais = ["Assassino", "Lobisomem", "Bruxa", "Médico", "Xerife"];
        papeisEspeciais.forEach(p => {
            let sortear = Math.floor(Math.random() * (jogadores.length - 1));
            jogadores[sortear].papel = p;
        });
    }

    // A MÁGICA DA INTELIGÊNCIA DOS BOTS
    function responderPergunta(alvo, pergunta) {
        const bot = jogadores.find(j => j.nome === alvo && j.vivo);
        if (!bot) return "Este jogador não pode responder agora.";

        pergunta = pergunta.toLowerCase();
        
        // 1. Lógica de "Quem é você?"
        if (pergunta.includes("quem é você") || pergunta.includes("seu papel")) {
            if (bot.papel === "Assassino" || bot.papel === "Lobisomem") {
                return "Eu? Sou apenas um Cidadão tentando sobreviver.";
            }
            return `Eu sou o ${bot.papel}. Pode confiar em mim.`;
        }

        // 2. Lógica de "Onde você estava?"
        if (pergunta.includes("onde") || pergunta.includes("estava")) {
            if (bot.papel === "Assassino") return "Eu estava na biblioteca lendo. Não vi nada.";
            return bot.memoriaLocal;
        }

        // 3. Lógica de "Quem é o culpado?"
        if (pergunta.includes("culpado") || pergunta.includes("assassino") || pergunta.includes("quem foi")) {
            let suspeito = jogadores.filter(j => j.vivo && j.nome !== bot.nome)[Math.floor(Math.random() * 5)].nome;
            return `Acho que o ${suspeito} está agindo de forma muito estranha hoje...`;
        }

        return "Não entendi sua pergunta, mas garanto que sou inocente.";
    }

    function processarTurnoJogador() {
        const input = document.getElementById('input-msg');
        const texto = input.value;
        if (!texto) return;

        adicionarMsg("player", texto);
        
        // Detectar se o jogador marcou alguém (ex: @Arthur) ou se é uma pergunta geral
        let botAlvo = nomes.find(n => texto.includes(n));
        
        setTimeout(() => {
            if (botAlvo) {
                const resposta = responderPergunta(botAlvo, texto);
                adicionarMsg("bot", `${botAlvo}: ${resposta}`);
            } else {
                adicionarMsg("bot", "Vila: (Silêncio...) Tente perguntar para alguém específico (ex: Arthur, quem é você?)");
            }
        }, 800);

        input.value = "";
    }

    function simularNoite() {
        document.getElementById('status-txt').innerText = "Fase: Noite";
        setTimeout(() => {
            // Um bot morre aleatoriamente (IA simulando o assassino)
            let vivos = jogadores.filter(j => j.vivo && j.nome !== "Você");
            let vitima = vivos[Math.floor(Math.random() * vivos.length)];
            vitima.vivo = false;

            adicionarMsg("system", `O DIA AMANHECEU. ${vitima.nome} foi encontrado morto!`);
            document.getElementById('status-txt').innerText = "Fase: Discussão (Pergunte aos bots)";
            
            // Atualiza memória dos bots sobre a morte
            jogadores.forEach(j => {
                if(j.vivo) j.memoriaLocal = `Eu ouvi barulhos perto da casa do ${vitima.nome}, mas fiquei com medo de sair.`;
            });
        }, 3000);
    }

    function adicionarMsg(tipo, texto) {
        const win = document.getElementById('chat-window');
        const div = document.createElement('div');
        div.className = `msg ${tipo}`;
        div.innerText = texto;
        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
    }

    window.onload = init;
</script>
</body>
</html>
