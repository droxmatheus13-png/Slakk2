<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arena PVP 3D - Mobile</title>
    <style>
        body { margin: 0; overflow: hidden; background: #111; font-family: sans-serif; }
        canvas { display: block; }
        
        /* Interface Mobile */
        #ui {
            position: absolute; top: 10px; left: 10px; color: white;
            pointer-events: none; text-shadow: 2px 2px 4px #000;
        }
        #joystick-container {
            position: absolute; bottom: 40px; left: 40px;
            width: 120px; height: 120px; background: rgba(255,255,255,0.2);
            border-radius: 50%; touch-action: none;
        }
        #joystick-knob {
            position: absolute; top: 35px; left: 35px;
            width: 50px; height: 50px; background: #fff; border-radius: 50%;
        }
        #attack-btn {
            position: absolute; bottom: 50px; right: 40px;
            width: 80px; height: 80px; background: rgba(255,0,0,0.6);
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; color: white; font-weight: bold;
            user-select: none; -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body>

    <div id="ui">
        <div>Sua Vida: <span id="player-hp">100</span></div>
        <div>Inimigo: <span id="ai-hp">100</span></div>
    </div>

    <div id="joystick-container">
        <div id="joystick-knob"></div>
    </div>

    <div id="attack-btn">ATACAR</div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- Configuração Básica ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x222222);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Luzes
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7.5);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040));

        // Chão
        const grid = new THREE.GridHelper(20, 20);
        scene.add(grid);

        // --- Personagens ---
        function createBox(color) {
            const geo = new THREE.BoxGeometry(1, 1, 1);
            const mat = new THREE.MeshStandardMaterial({ color });
            return new THREE.Mesh(geo, mat);
        }

        const player = createBox(0x00aaff);
        player.position.y = 0.5;
        scene.add(player);

        const ai = createBox(0xff3300);
        ai.position.set(5, 0.5, 5);
        scene.add(ai);

        camera.position.set(0, 10, 10);
        camera.lookAt(player.position);

        // --- Lógica de Jogo ---
        let playerHp = 100, aiHp = 100;
        let moveInput = { x: 0, y: 0 };
        let isAttacking = false;

        // --- Controles Mobile (Joystick) ---
        const knob = document.getElementById('joystick-knob');
        const container = document.getElementById('joystick-container');
        
        container.addEventListener('touchmove', (e) => {
            const touch = e.touches[0];
            const rect = container.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            let dx = touch.clientX - centerX;
            let dy = touch.clientY - centerY;
            const dist = Math.min(Math.sqrt(dx*dx + dy*dy), 50);
            const angle = Math.atan2(dy, dx);
            
            knob.style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
            
            moveInput.x = (Math.cos(angle) * dist) / 50;
            moveInput.y = (Math.sin(angle) * dist) / 50;
        });

        container.addEventListener('touchend', () => {
            knob.style.transform = `translate(0,0)`;
            moveInput = { x: 0, y: 0 };
        });

        document.getElementById('attack-btn').addEventListener('touchstart', () => {
            isAttacking = true;
            player.scale.set(1.2, 1.2, 1.2); // Feedback visual
            setTimeout(() => { 
                isAttacking = false; 
                player.scale.set(1,1,1);
            }, 200);
        });

        // --- Loop Principal ---
        function update() {
            // Movimento Jogador
            player.position.x += moveInput.x * 0.1;
            player.position.z += moveInput.y * 0.1;

            // IA segue o jogador
            const dist = player.position.distanceTo(ai.position);
            if(dist > 1.5) {
                const dir = new THREE.Vector3().subVectors(player.position, ai.position).normalize();
                ai.position.addScaledVector(dir, 0.05);
            } else {
                // IA Ataca se estiver perto
                if(Math.random() > 0.98) {
                    playerHp -= 5;
                    document.getElementById('player-hp').innerText = playerHp;
                }
            }

            // Jogador Ataca IA
            if(isAttacking && dist < 2) {
                aiHp -= 1;
                document.getElementById('ai-hp').innerText = Math.max(0, aiHp);
                ai.position.x += (ai.position.x - player.position.x) * 0.5; // Empurrão
            }

            // Camera segue o jogador suavemente
            camera.position.lerp(new THREE.Vector3(player.position.x, 10, player.position.z + 10), 0.1);
            camera.lookAt(player.position);

            if(playerHp <= 0) alert("Você Perdeu!");
            if(aiHp <= 0) alert("Você Venceu!");

            renderer.render(scene, camera);
            if(playerHp > 0 && aiHp > 0) requestAnimationFrame(update);
        }

        update();

        // Ajuste de tela
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
